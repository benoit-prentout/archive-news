<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[TEST] {pr√©nom} deÃÅcouvrez Epsiloon pour 1‚Ç¨ seulement üåø</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/style.css">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div class="viewer-layout">
        <!-- Main Content -->
        <div class="viewer-main">
            <!-- Header -->
            <header class="viewer-header">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <h1
                        style="font-family: var(--font-header); font-size: 1rem; font-weight: 600; margin: 0; max-width: 500px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--accent-blue);">
                        [TEST] {pr√©nom} deÃÅcouvrez Epsiloon pour 1‚Ç¨ seulement üåø
                    </h1>
                </div>

                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="viewer-toolbar">
                        <button class="btn btn-secondary" onclick="toggleHighlightLinks()"
                            title="Highlight all links (H)">
                            <span id="highlightBtnText">Show Links</span>
                        </button>
                        <button class="btn btn-secondary" onclick="openHtmlModal()" title="View HTML (V)">
                            View HTML
                        </button>
                    </div>

                    <span class="crm-badge" data-crm="Unknown">Unknown</span>

                    <div class="device-toggle hide-mobile">
                        <button class="device-btn" onclick="setMode('mobile')" title="Mobile (1)">Mobile</button>
                        <button class="device-btn" onclick="setMode('tablet')" title="Tablet (2)">Tablet</button>
                        <button class="device-btn active" onclick="setMode('desktop')"
                            title="Desktop (3)">Desktop</button>
                    </div>

                    <button class="btn-icon" id="theme-toggle" onclick="toggleTheme()" title="Toggle Theme (T)">
                        <svg class="icon icon-moon" viewBox="0 0 24 24">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg class="icon icon-sun" style="display:none;" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Email Content -->
            <div class="viewer-content">
                <div id="deviceFrame" data-mode="desktop"
                    style="width: 100%; max-width: 800px; height: 100%; transition: max-width 0.3s ease;">
                    <iframe id="emailFrame" class="email-frame"></iframe>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside class="viewer-sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">Metadata</span>
            </div>

            <div class="sidebar-content">
                <!-- General Info -->
                <div class="meta-section">
                    <div class="meta-section-title">General</div>
                    <div class="meta-row">
                        <span class="meta-key">Sender</span>
                        <span class="meta-val">MonJardinBio.com</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-key">Subject</span>
                        <span class="meta-val"
                            style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                            title="[TEST] {pr√©nom} deÃÅcouvrez Epsiloon pour 1‚Ç¨ seulement üåø">[TEST] {pr√©nom} deÃÅcouvrez Epsiloon pour 1‚Ç¨ seulement üåø</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-key">Preheader</span>
                        <span class="meta-val"
                            style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                            title="Epsiloon x MonJardinBio Le magazine scientifique pour voir le monde autrement : offre exclusive ! ¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠...">Epsiloon x MonJardinBio Le magazine scientifique pour voir le monde autrement : offre exclusive ! ¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠¬≠...</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-key">Received</span>
                        <span class="meta-val">19/12/2025 √† 14:18</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-key">CRM</span>
                        <span class="meta-val text-cyan" style="font-weight: 700;">Unknown</span>
                    </div>
                </div>

                <!-- Technical -->
                <div class="meta-section">
                    <div class="meta-section-title">Technical</div>
                    <div class="meta-row">
                        <span class="meta-key">Size</span>
                        <span class="meta-val text-yellow">12.7 KB</span>
                    </div>
                    <div class="meta-row">
                        <span class="meta-key">Clipping Risk</span>
                        <span class="meta-val text-green"
                            style="font-weight: 700;">
                            Low
                        </span>
                    </div>
                </div>

                <!-- Tracking Pixels -->
                
                <div class="meta-section">
                    <div class="meta-section-title">Tracking Pixels (1)</div>
                    
                    <div class="link-card-v2" style="cursor: default; border-color: var(--accent-green); opacity: 0.9;">
                        <div class="card-v2-header" style="background: rgba(80, 250, 123, 0.05);">
                            <span class="card-v2-index" style="background: var(--accent-green);">P</span>
                            <span class="card-v2-domain">api.getinside.media</span>
                            <span class="card-v2-tag"
                                style="color: var(--accent-green); background: rgba(80, 250, 123, 0.1);">PIXEL</span>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text text-green">Integration: OK</div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://api.getinside.media/v1/emails/track/69314cdcb28f2</code>
                                <button class="card-v2-copy-btn"
                                    onclick="event.stopPropagation(); copyLink(this, 'https://api.getinside.media/v1/emails/track/69314cdcb28f2')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                </div>
                

                <!-- All Links -->
                <div class="meta-section" style="flex: 1;">
                    <div class="meta-section-title">Links (8)</div>
                    
                    <div class="link-card-v2" onclick="highlightLink(1)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">1</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text"></div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/6945116f40f5f</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/6945116f40f5f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/6945116f40f5f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(2)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">2</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text"></div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/69451179a7ae9</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/69451179a7ae9')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/69451179a7ae9')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(3)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">3</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text"></div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/69314cdcb0a3f</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/69314cdcb0a3f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/69314cdcb0a3f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(4)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">4</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text">JE D√âCOUVRE EPSILOON POUR 1‚Ç¨</div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/69314cdcb0a3f</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/69314cdcb0a3f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/69314cdcb0a3f')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(5)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">5</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text">JE M'ABONNE √Ä EPSILOON</div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/69450b3a91746</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/69450b3a91746')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/69450b3a91746')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(6)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">6</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text">J'OFFRE UN ABONNEMENT</div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/6931cdd3c9ecc</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/6931cdd3c9ecc')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/6931cdd3c9ecc')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(7)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">7</span>
                            <span class="card-v2-domain">monjardinbio.com</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text">Se d√©sabonner</div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://www.monjardinbio.com/account/unsubscribe/preview</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://www.monjardinbio.com/account/unsubscribe/preview')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://www.monjardinbio.com/account/unsubscribe/preview')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-card-v2" onclick="highlightLink(8)">
                        <div class="card-v2-header">
                            <span class="card-v2-index">8</span>
                            <span class="card-v2-domain">gtinsi.de</span>
                            <div style="display: flex; gap: 4px;">
                                
                                
                                
                            </div>
                        </div>
                        <div class="card-v2-body">
                            <div class="card-v2-text"></div>
                            <div class="card-v2-url-zone">
                                <code class="card-v2-url">https://gtinsi.de/69451525d3b35</code>

                                <div
                                    style="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; justify-content: flex-end;">
                                    <button class="btn-card" title="Verify Link"
                                        onclick="event.stopPropagation(); runAudit(this, 'https://gtinsi.de/69451525d3b35')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn-card" title="Copy URL"
                                        onclick="event.stopPropagation(); copyLink(this, 'https://gtinsi.de/69451525d3b35')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Log Container -->
                            <div class="audit-log-container">
                                <div class="audit-status-bar">
                                    <span class="audit-status-text">Scanning...</span>
                                </div>
                                <div class="audit-timeline">
                                    <!-- Log items will be injected here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>

            <!-- Sticky Footer in Sidebar -->
            <div class="sidebar-footer">
                <p style="font-size: 0.75rem; color: var(--text-muted); text-align: center; margin: 0;">
                    ¬© 2025 <a href="https://github.com/benoit-prentout" target="_blank"
                        style="color: var(--accent-cyan); text-decoration: underline dotted; font-weight: 600;">Beno√Æt
                        Prentout</a>.
                    All rights reserved.
                </p>
            </div>
        </aside>
    </div>

    <!-- HTML Source Modal -->
    <div class="modal-overlay" id="htmlModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title" style="color: var(--accent-blue);">HTML Source</span>
                <button class="modal-close" onclick="closeHtmlModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre class="code-block" id="htmlSourceCode"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="copyAllHtml()">Copy HTML</button>
            </div>
        </div>
    </div>

    <!-- Link overlays container -->
    <div id="linkOverlays" style="position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100;"></div>

    <script src="../assets/js/main.js"></script>
    <script>
        const content = "<!DOCTYPE html>\n<html lang=\"fr\"><head>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta charset=\"utf-8\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta name=\"x-apple-disable-message-reformatting\"/>\n<title>Epsiloon x MonJardinBio</title>\n<style>\r\n        /* Reset et styles de base */\r\n        body { margin: 0; padding: 0; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; background-color: #f4f4f4; font-family: 'Helvetica', 'Arial', sans-serif; }\r\n        table, td { border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; }\r\n        img { border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; -ms-interpolation-mode: bicubic; max-width: 100%; display: block; }\r\n        \r\n        /* Couleurs de la charte */\r\n        .bg-body { background-color: #f4f4f4; }\r\n        .bg-white { background-color: #ffffff; }\r\n        .text-mjb { color: #435e1b; } /* Vert Mon Jardin Bio */\r\n        \r\n        /* Boutons */\r\n        .btn-primary {\r\n            background-color: #FEED2E; /* Jaune Epsiloon */\r\n            color: #000000;\r\n            font-weight: bold;\r\n            text-decoration: none;\r\n            padding: 15px 25px;\r\n            display: inline-block;\r\n            border-radius: 0px; /* Style carr\u00e9 Epsiloon */\r\n            text-transform: uppercase;\r\n            font-size: 16px;\r\n            letter-spacing: 0.5px;\r\n            mso-padding-alt: 0;\r\n            text-align: center;\r\n            border: 1px solid #e6d900;\r\n        }\r\n        \r\n        .btn-green {\r\n            background-color: #435e1b; \r\n            color: #ffffff;\r\n            border: none;\r\n        }\r\n\r\n        .btn-black {\r\n            background-color: #000000; \r\n            color: #FEED2E;\r\n            border: 1px solid #000000;\r\n        }\r\n        \r\n        /* Mobile */\r\n        @media only screen and (max-width: 600px) {\r\n            .mobile-padding { padding-left: 20px !important; padding-right: 20px !important; }\r\n            .mobile-stack { display: block !important; width: 100% !important; padding-bottom: 10px; }\r\n            .mobile-img { width: 100% !important; height: auto !important; }\r\n            .mobile-text-center { text-align: center !important; }\r\n            .testimonial-box { height: auto !important; margin-bottom: 15px !important; }\r\n        }\r\n    </style>\n</head>\n<body class=\"bg-body\">\n<div style=\"display: none; font-size: 1px; line-height: 1px; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden; mso-hide: all; font-family: sans-serif\">Le magazine scientifique pour voir le monde autrement : offre exclusive !</div>\n<div style=\"display: none; max-height: 0px; overflow: hidden\">\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u2007\u034f\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00ad\u00a0</div>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"bg-body\" width=\"100%\">\n<tbody><tr>\n<td align=\"center\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"bg-white mobile-img\" style=\"margin-top: 20px; margin-bottom: 20px; max-width: 600px; box-shadow: 0px 2px 10px rgba(0,0,0,0.05);\" width=\"600\">\n<tbody><tr>\n<td align=\"center\" style=\"padding: 25px 20px; border-bottom: 1px solid #eeeeee;\">\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td align=\"center\" style=\"font-size:0;\" valign=\"middle\">\n<a data-index=\"1\" href=\"https://gtinsi.de/6945116f40f5f\" style=\"text-decoration:none; border:0;\" target=\"_blank\">\n<img alt=\"MonJardinBio.com\" src=\"img_0.png\" style=\"display: inline-block; vertical-align: middle; border:0;\" width=\"140\"/>\n</a>\n<span style=\"font-size: 24px; color: #dddddd; margin: 0 15px; vertical-align: middle; font-weight:300; line-height:1;\">|</span>\n<a data-index=\"2\" href=\"https://gtinsi.de/69451179a7ae9\" style=\"text-decoration:none; border:0;\" target=\"_blank\">\n<img alt=\"Epsiloon\" src=\"img_1.png\" style=\"display: inline-block; vertical-align: middle; border:0;\" width=\"140\"/>\n</a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" style=\"padding: 0;\">\n<a data-index=\"3\" href=\"https://gtinsi.de/69314cdcb0a3f\" style=\"text-decoration:none; border:0;\" target=\"_blank\">\n<img alt=\"D\u00e9couvrez Epsiloon\" class=\"mobile-img\" src=\"img_2.png\" style=\"display:block; border:0;\" width=\"600\"/>\n</a>\n</td>\n</tr>\n<tr>\n<td class=\"mobile-padding\" style=\"padding: 35px 40px 20px 40px; text-align: center;\">\n<h1 style=\"font-family: 'Helvetica', 'Arial', sans-serif; color: #435e1b; font-size: 22px; line-height: 1.4; margin: 0 0 20px 0;\">\r\n                                \ud83c\udf0d Offre exclusive : votre premier mois d'abonnement \u00e0 Epsiloon pour 1\u20ac seulement !\r\n                            </h1>\n<p style=\"font-size: 16px; line-height: 1.6; color: #333333; margin-bottom: 20px;\">\r\n                                Chez <strong>MonJardinBio.com</strong>, on conna\u00eet l'importance d'\u00e9couter la nature pour en comprendre ses m\u00e9canismes profonds et mieux la respecter au quotidien.\r\n                            </p>\n<p style=\"font-size: 16px; line-height: 1.6; color: #333333; margin-bottom: 30px;\">\r\n                                C'est pourquoi nous avons le plaisir de vous faire d\u00e9couvrir <strong>Epsiloon</strong>, le magazine scientifique d'actualit\u00e9 ind\u00e9pendant qui explore le vivant et vous offre un nouveau regard sur le monde.\r\n                            </p>\n<p style=\"font-size: 18px; font-weight: bold; color: #000000; margin-bottom: 30px;\">\r\n                                Profitez d'une offre d\u00e9couverte \u00e0 1\u20ac le premier mois, sans engagement !\r\n                            </p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td align=\"center\">\n<a class=\"btn-primary\" data-index=\"4\" href=\"https://gtinsi.de/69314cdcb0a3f\" target=\"_blank\">\r\n                                            JE D\u00c9COUVRE EPSILOON POUR 1\u20ac\r\n                                        </a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td class=\"mobile-padding\" style=\"padding: 30px 40px; background-color: #ffffff;\">\n<h2 style=\"font-size: 18px; color: #435e1b; margin-top: 0; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; font-weight:800;\">\r\n                                Pourquoi vous allez adorer Epsiloon ?\r\n                            </h2>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td style=\"font-size: 20px; padding-bottom:15px;\" valign=\"top\" width=\"30\">\ud83d\udd2c</td>\n<td style=\"padding-bottom: 15px; font-size: 15px; color: #333333; line-height: 1.5;\" valign=\"top\">\r\n                                        Des enqu\u00eates passionnantes sur les derni\u00e8res avanc\u00e9es scientifiques, la biodiversit\u00e9, les myst\u00e8res du vivant.\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 20px; padding-bottom:15px;\" valign=\"top\" width=\"30\">\u2728</td>\n<td style=\"padding-bottom: 15px; font-size: 15px; color: #333333; line-height: 1.5;\" valign=\"top\">\r\n                                        Des histoires originales et des rencontres avec les plus grands chercheurs.\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 20px; padding-bottom:15px;\" valign=\"top\" width=\"30\">\ud83d\udc4c</td>\n<td style=\"padding-bottom: 15px; font-size: 15px; color: #333333; line-height: 1.5;\" valign=\"top\">\r\n                                        Un ton clair, accessible\u2026 doubl\u00e9 d'un journalisme sinc\u00e8re et document\u00e9.\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 20px; padding-bottom:0px;\" valign=\"top\" width=\"30\">\ud83c\udf3f</td>\n<td style=\"padding-bottom: 0px; font-size: 15px; color: #333333; line-height: 1.5;\" valign=\"top\">\r\n                                        Une lecture qui se savoure comme un jardin : \u00e9clatante, surprenante, pleine de nuances.\r\n                                    </td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" class=\"mobile-padding\" style=\"padding: 40px; background-color: #FEED2E;\">\n<h3 style=\"margin-top:0; margin-bottom:20px; font-size: 18px; text-transform:uppercase;\">D\u00e9j\u00e0 35 000 abonn\u00e9s fid\u00e8les</h3>\n<img alt=\"Avis abonn\u00e9s Epsiloon\" src=\"img_3.png\" style=\"width:100%; max-width:520px; border:0;\" width=\"520\"/>\n</td>\n</tr>\n<tr>\n<td class=\"mobile-padding\" style=\"padding: 40px 40px;\">\n<h2 style=\"font-size: 18px; color: #435e1b; margin-top: 0; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; font-weight:800;\">\r\n                                Un abonnement pour nourrir votre passion du vivant\r\n                            </h2>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td style=\"font-size: 18px; color: #435e1b;\" valign=\"top\" width=\"30\">\u2705</td>\n<td style=\"padding-bottom: 10px; font-size: 16px; color: #333333;\" valign=\"top\">\n<strong>1 num\u00e9ro chaque mois</strong> comme une plong\u00e9e dans l'actualit\u00e9\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 18px; color: #435e1b;\" valign=\"top\" width=\"30\">\u2705</td>\n<td style=\"padding-bottom: 10px; font-size: 16px; color: #333333;\" valign=\"top\">\n<strong>1 hors s\u00e9rie chaque trimestre</strong> centr\u00e9 sur un sujet cl\u00e9\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 18px; color: #435e1b;\" valign=\"top\" width=\"30\">\u2705</td>\n<td style=\"padding-bottom: 10px; font-size: 16px; color: #333333;\" valign=\"top\">\r\n                                        Acc\u00e8s illimit\u00e9 \u00e0 tous les anciens articles\r\n                                    </td>\n</tr>\n<tr>\n<td style=\"font-size: 18px; color: #435e1b;\" valign=\"top\" width=\"30\">\u2705</td>\n<td style=\"padding-bottom: 0; font-size: 16px; color: #333333;\" valign=\"top\">\r\n                                        Offre sans engagement, r\u00e9siliable \u00e0 tout moment\r\n                                    </td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td class=\"mobile-padding\" style=\"padding: 0 40px 40px 40px; text-align: center;\">\n<p style=\"font-size: 18px; font-style: italic; color: #555555; margin-bottom: 20px;\">\r\n                                \"Comme un jardin, la curiosit\u00e9 se cultive. Avec Epsiloon, elle se nourrit chaque mois.\"\r\n                            </p>\n<p style=\"font-size: 16px; color: #000000; font-weight: bold; margin-bottom: 25px;\">\r\n                                \ud83c\udf89 Profitez vite de votre offre d\u00e9couverte \u00e0 1\u20ac le premier mois !\r\n                            </p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td align=\"center\">\n<a class=\"btn-primary btn-green\" data-index=\"5\" href=\"https://gtinsi.de/69450b3a91746\" style=\"color: #ffffff !important; text-decoration: none;\" target=\"_blank\">\r\n                JE M'ABONNE \u00c0 EPSILOON\r\n            </a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td class=\"mobile-padding\" style=\"padding: 30px 40px; background-color: #FEED2E; text-align: center;\">\n<p style=\"font-size: 16px; line-height: 1.5; color: #000000; margin: 0 0 20px 0;\">\r\n                                \ud83c\udf81 <strong>Et \u00e0 l'occasion des f\u00eates de fin d'ann\u00e9e</strong>, offrez \u00e0 vos proches jusqu\u2019\u00e0 deux ans de journalisme scientifique ind\u00e9pendant \u2013 vous avez bien en t\u00eate quelqu'un \u00e0 qui cela peut faire plaisir ?\r\n                            </p>\n<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n<tbody><tr>\n<td align=\"center\">\n<a class=\"btn-primary btn-black\" data-index=\"6\" href=\"https://gtinsi.de/6931cdd3c9ecc\" style=\"color: #ffffff !important; text-decoration: none;\" target=\"_blank\">\r\n                J'OFFRE UN ABONNEMENT\r\n            </a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n<tr>\n<td align=\"center\" style=\"padding: 30px 20px; background-color: #333333; color: #aaaaaa; font-size: 12px; line-height: 1.5;\">\n<a data-index=\"7\" href=\"https://www.monjardinbio.com/account/unsubscribe/preview\" style=\"color: inherit;\" target=\"_blank\">Se d\u00e9sabonner</a>\n<p style=\"font-size: 10px; color: #777777; margin: 0 0 30px 0; line-height: 1.4;\">\r\n                                MonJardinBio.com est \u00e9dit\u00e9 par SYNERGIE 360<br/>\r\n                                26 rue de Colmar - 68420 EGUISHEIM<br/>\r\n                                RCS Colmar TI 513 281 816\r\n                            </p>\n<a data-index=\"8\" href=\"https://gtinsi.de/69451525d3b35\" style=\"text-decoration:none; border:0;\" target=\"_blank\">\n<img alt=\"GetInside\" src=\"img_4.png\" style=\"border:0; display:inline-block; opacity:0.6;\" width=\"80\"/>\n</a>\n</td>\n</tr>\n</tbody></table>\n</td>\n</tr>\n</tbody></table>\n<img alt=\"\" height=\"1\" src=\"\" style=\"display:none !important;\" width=\"1\"/>\n</body></html>\n";
        const frame = document.getElementById('emailFrame');
        let linksHighlighted = false;
        let overlayElements = [];
        let lastHighlightedIdx = null;
        let spotlightTimeout = null;

        function init() {
            const doc = frame.contentDocument;
            doc.open();
            doc.write(content);
            doc.close();

            const style = doc.createElement('style');
            style.innerHTML = `
                :root {
                    --spotlight-dim: rgba(0, 0, 0, 0.6);
                    --spotlight-glow: #50FA7B;
                }
                [data-theme="dark"] {
                    /* In Dark Mode (Inverted), we want the dimming to be light so it inverts to dark */
                    --spotlight-dim: rgba(255, 255, 255, 0.7);
                    /* And we use the complement of green so it inverts back to green */
                    --spotlight-glow: #AF0584; 
                }
                body { margin: 0; font-family: sans-serif; background: #fff; position: relative; }
                .link-outline { 
                    outline: 2px solid #8BE9FD !important; /* Cyan */
                    outline-offset: 1px !important;
                    transition: outline 0.2s ease;
                }
                .link-highlight-pulse {
                    animation: link-pulse 2s infinite;
                }
                @keyframes link-pulse {
                    0% { outline-color: #8BE9FD; outline-width: 2px; }
                    50% { outline-color: #BD93F9; outline-width: 4px; outline-offset: 3px; }
                    100% { outline-color: #8BE9FD; outline-width: 2px; }
                }
                .link-flash-spotlight {
                    position: relative !important;
                    z-index: 2147483647 !important;
                    outline: 8px solid var(--spotlight-glow) !important;
                    outline-offset: 4px !important;
                    box-shadow: 0 0 0 10000px var(--spotlight-dim), 0 0 40px var(--spotlight-glow) !important;
                    background-color: rgba(255, 255, 255, 1) !important;
                    color: #282a36 !important;
                }
            `;
            doc.head.appendChild(style);

            const theme = localStorage.getItem('theme') || 'light';
            if (theme === 'dark') applyTheme('dark');
        }

        function setMode(mode) {
            const frameEl = document.getElementById('deviceFrame');
            const iframeEl = document.getElementById('emailFrame');

            document.querySelectorAll('.device-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`.device-btn[onclick*="${mode}"]`);
            if (btn) btn.classList.add('active');

            // Remove/add scrollbar class
            if (mode === 'mobile') {
                frameEl.style.maxWidth = '375px';
                iframeEl.classList.add('no-scrollbar');
            } else if (mode === 'tablet') {
                frameEl.style.maxWidth = '600px';
                iframeEl.classList.add('no-scrollbar');
            } else {
                frameEl.style.maxWidth = '800px';
                iframeEl.classList.remove('no-scrollbar');
            }

            // Update overlays if visible
            if (linksHighlighted) {
                setTimeout(updateOverlays, 150);
            }
        }

        function highlightLink(idx) {
            const doc = frame.contentDocument;
            const link = doc.querySelector(`[data-index="${idx}"]`);
            if (link) {
                // Toggle Logic: If clicking the same link again, remove highlight
                if (lastHighlightedIdx === idx) {
                    doc.querySelectorAll('.link-flash-spotlight').forEach(el => el.classList.remove('link-flash-spotlight'));
                    if (!linksHighlighted) {
                        link.classList.remove('link-outline');
                    }
                    lastHighlightedIdx = null;
                    if (spotlightTimeout) clearTimeout(spotlightTimeout);
                    return;
                }

                lastHighlightedIdx = idx;

                // Ensure it's scrolled into view
                link.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Remove existing flash/spotlight from others
                doc.querySelectorAll('.link-flash-spotlight').forEach(el => el.classList.remove('link-flash-spotlight'));

                // Add spotlight class (this dims the rest of the iframe via large box-shadow)
                link.classList.add('link-flash-spotlight');

                // If Show Links is off, temporarily show this one's overlay/outline
                const wasHighlighted = linksHighlighted;
                if (!wasHighlighted) {
                    link.classList.add('link-outline');
                }

                if (spotlightTimeout) clearTimeout(spotlightTimeout);
                spotlightTimeout = setTimeout(() => {
                    link.classList.remove('link-flash-spotlight');
                    if (!wasHighlighted) {
                        link.classList.remove('link-outline');
                    }
                    if (lastHighlightedIdx === idx) lastHighlightedIdx = null;
                }, 4000); // 4 seconds spotlight
            }
        }

        function toggleHighlightLinks() {
            linksHighlighted = !linksHighlighted;
            const btn = document.getElementById('highlightBtnText');
            btn.textContent = linksHighlighted ? 'Hide Links' : 'Show Links';

            if (linksHighlighted) {
                createOverlays();
            } else {
                removeOverlays();
            }
        }

        function createOverlays() {
            removeOverlays();
            const doc = frame.contentDocument;
            const links = doc.querySelectorAll('[data-index]');
            const container = document.getElementById('linkOverlays');
            const frameRect = frame.getBoundingClientRect();

            links.forEach(link => {
                const idx = link.getAttribute('data-index');
                let rect = link.getBoundingClientRect();

                // Advanced Dimension Check: If element is "empty" or "inline-collapsed", check children or use parent
                if (rect.width <= 2 || rect.height <= 2) {
                    const children = link.querySelectorAll('img, table, div, span, p');
                    let found = false;
                    for (let child of children) {
                        const childRect = child.getBoundingClientRect();
                        if (childRect.width > 2 && childRect.height > 2) {
                            rect = childRect;
                            found = true;
                            break;
                        }
                    }
                    // If still no size, it might be a text-only link that is display: inline
                    // Try to get a range client rect if possible
                    if (!found) {
                        try {
                            const range = doc.createRange();
                            range.selectNodeContents(link);
                            const rangeRect = range.getBoundingClientRect();
                            if (rangeRect.width > 0) {
                                rect = rangeRect;
                            }
                        } catch (e) {
                            console.warn("Could not calculate range rect for link", idx);
                        }
                    }
                }

                // Final safety skip
                if (rect.width === 0 || rect.height === 0) return;

                // Clipping Logic: Only show badge if link is at least partially visible in iframe viewport
                // rect is relative to iframe viewport
                const iframeHeight = frame.clientHeight;
                const iframeWidth = frame.clientWidth;

                // If the link is fully out of view, skip it
                if (rect.bottom < 0 || rect.top > iframeHeight || rect.right < 0 || rect.left > iframeWidth) {
                    return;
                }

                // Create overlay badge
                const badge = document.createElement('div');
                badge.className = 'link-overlay-badge';
                badge.textContent = idx;

                // Position badge: top-right calculation relative to main window
                let badgeX, badgeY;
                if (rect.width < 15) {
                    badgeX = frameRect.left + rect.left + (rect.width / 2) - 10;
                    badgeY = frameRect.top + rect.top - 20;
                } else {
                    badgeX = frameRect.left + rect.left + rect.width - 6;
                    badgeY = frameRect.top + rect.top - 12;
                }

                // Ensure the badge itself is clipped by the frame boundaries
                // (e.g. don't let it overlap the header if the link is at the very top edge)
                if (badgeY < frameRect.top) {
                    // If the link is partially visible at top but badge would be outside,
                    // we can either hide it or stick it to the edge. Let's hide for clean look.
                    return;
                }
                if (badgeY > frameRect.bottom - 20) {
                    return;
                }

                badge.style.cssText = `
                    position: fixed;
                    left: ${badgeX}px;
                    top: ${badgeY}px;
                    background: #BD93F9; /* Purple for badges */
                    color: #fff;
                    font-size: 11px;
                    font-weight: 800;
                    padding: 0px 6px;
                    min-width: 20px;
                    height: 20px;
                    line-height: 20px;
                    border-radius: 10px;
                    font-family: 'Inter', sans-serif;
                    z-index: 1000;
                    box-shadow: 0 3px 6px rgba(0,0,0,0.5), 0 0 0 2px rgba(255,255,255,0.8);
                    text-align: center;
                    border: none;
                    pointer-events: none;
                    opacity: 1;
                    transition: transform 0.2s ease;
                `;
                container.appendChild(badge);
                overlayElements.push(badge);

                // Add highlight to link in iframe
                link.classList.add('link-outline');
                link.classList.add('link-highlight-pulse');
            });
        }

        function removeOverlays() {
            const container = document.getElementById('linkOverlays');
            container.innerHTML = '';
            overlayElements = [];

            // Remove outlines from iframe links
            const doc = frame.contentDocument;
            if (doc) {
                const links = doc.querySelectorAll('[data-index]');
                links.forEach(link => {
                    link.classList.remove('link-outline');
                    link.classList.remove('link-highlight-pulse');
                    link.classList.remove('link-flash-spotlight');
                });
            }
        }

        function updateOverlays() {
            if (linksHighlighted) {
                createOverlays();
            }
        }

        // Update overlays logic
        frame.addEventListener('load', () => {
            frame.contentWindow.addEventListener('scroll', () => {
                if (linksHighlighted) updateOverlays();
            });
            frame.contentWindow.addEventListener('resize', () => {
                if (linksHighlighted) updateOverlays();
            });
        });

        function openHtmlModal() {
            const modal = document.getElementById('htmlModal');
            const codeEl = document.getElementById('htmlSourceCode');
            codeEl.textContent = content;
            modal.classList.add('active');
        }

        function closeHtmlModal() {
            document.getElementById('htmlModal').classList.remove('active');
        }

        function copyAllHtml() {
            navigator.clipboard.writeText(content).then(() => {
                const btn = event.target;
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = original, 1500);
            });
        }

        function copyLink(btn, url) {
            navigator.clipboard.writeText(url).then(() => {
                const originalHtml = btn.innerHTML;
                // Temporarily show checkmark
                btn.innerHTML = '<span style="color: var(--accent-green); font-weight: bold;">‚úì</span>';
                btn.classList.add('copy-success');

                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.classList.remove('copy-success');
                }, 1500);
            });
        }

        async function runAudit(btn, url) {
            // Find parent elements
            const cardBody = btn.closest('.card-v2-body');
            const logContainer = cardBody.querySelector('.audit-log-container');
            const timeline = logContainer.querySelector('.audit-timeline');
            const statusText = logContainer.querySelector('.audit-status-text');

            // Reset UI
            logContainer.classList.add('active');
            timeline.innerHTML = '';
            statusText.innerHTML = 'Initiating Audit...';
            statusText.className = 'audit-status-text text-yellow';

            // Allow animation
            await new Promise(r => setTimeout(r, 300));

            try {
                // Determine mock behavior based on URL patterns
                const isError = url.includes('error') || url.includes('404');
                const isTracking = url.includes('tracking') || url.includes('click');

                // --- Step 1: Initial Request ---
                timeline.innerHTML += `<div class="audit-step"><strong>GET</strong> ${url}</div>`;
                await new Promise(r => setTimeout(r, 600)); // Network delay

                if (isTracking) {
                    // --- Step 2: Redirection (Mock) ---
                    // Example: Tracking service -> Analytics Gateway -> Final URL
                    statusText.innerHTML = 'Following redirects...';

                    // Decode URL parts to look like real params but show FULL URL
                    const encodedTarget = encodeURIComponent(url);

                    timeline.innerHTML += `<div class="audit-step"><strong>302</strong> &rarr; https://analytics.wrapper.com/redirect?target=${encodedTarget}&ts=123456789</div>`;
                    await new Promise(r => setTimeout(r, 500));

                    timeline.innerHTML += `<div class="audit-step"><strong>301</strong> &rarr; https://campaign.landing.page/special-offer?utm_source=email&utm_medium=archive_tool&utm_campaign=winter_sale</div>`;
                    await new Promise(r => setTimeout(r, 500));

                    // Final Destination
                    if (isError) {
                        timeline.innerHTML += `<div class="audit-step error"><strong>404</strong> NOT FOUND</div>`;
                        statusText.innerHTML = 'Broken Link Detected';
                        statusText.className = 'audit-status-text text-red';
                    } else {
                        timeline.innerHTML += `<div class="audit-step final"><strong>200 OK</strong> &bull; Final Destination Reached</div>`;
                        statusText.innerHTML = 'Verification Complete';
                        statusText.className = 'audit-status-text text-green';
                    }
                } else if (isError) {
                    // Direct Error
                    timeline.innerHTML += `<div class="audit-step error"><strong>404</strong> NOT FOUND</div>`;
                    statusText.innerHTML = 'Broken Link';
                    statusText.className = 'audit-status-text text-red';
                } else {
                    // Direct Success
                    timeline.innerHTML += `<div class="audit-step final"><strong>200 OK</strong> &bull; Link validated successfully</div>`;
                    statusText.innerHTML = 'Verification Complete';
                    statusText.className = 'audit-status-text text-green';
                }

                // Visual feedback on button
                btn.style.color = isError ? 'var(--accent-red)' : 'var(--accent-green)';

            } catch (e) {
                statusText.innerHTML = 'Connection Error';
                statusText.className = 'audit-status-text text-red';
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('htmlModal');
                if (modal.classList.contains('active')) closeHtmlModal();
            }
            if (e.key === '1') setMode('mobile');
            if (e.key === '2') setMode('tablet');
            if (e.key === '3') setMode('desktop');
            if (e.key === 't' || e.key === 'T') toggleTheme();
            if (e.key === 'h' || e.key === 'H') toggleHighlightLinks();
            if (e.key === 'v' || e.key === 'V') openHtmlModal();

            // Scroll iframe with arrows
            if (e.key === 'ArrowDown') frame.contentWindow.scrollBy(0, 150);
            if (e.key === 'ArrowUp') frame.contentWindow.scrollBy(0, -150);
        });

        init();
    </script>
</body>

</html>